{% extends "site_base.html" %}
{% load i18n %}
{% load dialogos_tags %}
{% load pinax_ratings_tags %}
{% load bootstrap_tags %}
{% load base_tags %}
{% load guardian_tags %}

{% block title %}Manejador de contenidos{% endblock %}
{% block head %}{{ block.super }}
<link href="{{ STATIC_URL }}idegeo/interactive/css/base_documents.css" rel="stylesheet" type="text/css">
<link href="{{ STATIC_URL }}idegeo/ms/css/ms.css" rel="stylesheet" type="text/css">
<link href="{{ STATIC_URL }}idegeo/bootstrap/bootstrap-responsive.css" rel="stylesheet" type="text/css">
<link href="{{STATIC_URL}}idegeo/ms/css/dd_paletas.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="{{STATIC_URL}}idegeo/geonode/css/colorbox/colorbox.css" />
<link href="{{ STATIC_URL }}idegeo/bootstrap/bootstrap-responsive.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.17.1/dist/bootstrap-table.min.css">
<link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-colorpicker/2.3.3/css/bootstrap-colorpicker.min.css" rel="stylesheet">
<link rel="stylesheet" href="{{STATIC_URL}}idegeo/content_handler/css/home.css"/>

<script src="http://d3js.org/d3.v3.min.js"></script>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
<style>
    .node {
        cursor: pointer;
    }

    .node circle {
        fill: #fff;
        stroke: steelblue;
        stroke-width: 3px;
    }

    .node text {
        font: 12px sans-serif;
    }

    .link {
        fill: none;
        stroke: #ccc;
        stroke-width: 2px;
    }

    div.tooltip-menu {
        position: absolute;
        text-align: center;
        padding: 4px;
        font: 14px sans-serif;
        background: lightsteelblue;
        border: 0px;
        border-radius: 8px;
        z-index:999;
    }
    h2 {
        font-size: 20px;
        color: #4b8865;
        margin-bottom: 5px;
    }
</style>
{% endblock %}
{% block body_class %}layers{% endblock %}

{% block middle %}
{% block body_outer %}
<div id="page-header" class="content">
    <div class="container">
        <div class="titulo-blk-row">
            <div class="titulo-img blk-cell">
                <i class="fa fa-home fa-5x title-detail" title="Instituciones participantes" aria-hidden="true"></i>
            </div>
            <div class="titulo-txt blk-cell">
                <h2>Manejador de contenidos</h2>
            </div>
        </div>
    </div>
</div>
{% include "modal_colors.html" %}
{% endblock %}

{% if request.user.is_staff or request.user.home_access %}
<div class="container">
    <div class="ms-container-header">
        <div class="project-title clearfix">
            <span class="ms-close-detail">
                <a href="{% url 'content_handler_list' %}"><i class="fa fa-chevron-left" title="Regresar"></i></a>
            </span>
            <h3 title="{{ms.name}}">
                {{ms.name|truncatechars:55}}
                {% if header %}
                    <a href="{% url 'handler_home' ms.url_name %}" id="nw" target="_blank"><i class="fa fa-arrow-circle-right" title="Ir a"></i></a>
                    {% if not ms.public %}
                        <a href="{% url 'hd_publish_managment' ms.id %}" class="btn btn-primary btn-sm pull-right" title="Publlicar Sitio" id="btn-list"> Publicar</a>
                    {% endif %}
                {% endif %}
            </h3>

            <span class="close_hd">
              <a href="{% url 'update_handler' ms.id %}"><i class="fa fa-bars" title="Editar Metadato" aria-hidden="true"></i></a>
              <a href="{% url 'remove_handler' ms.id %}"><i class="fa fa-trash" title="Eliminar" aria-hidden="true"></i></a>
            </span>
        </div>
        <!-- Home-->

        <table class="hor-minimalist-b">
            <tr>
                <td>Acceso al home:</td>
                <td>
                    {% if header %}
                        <a href="{% url 'handler_home' ms.url_name %}" target="_blank">{{site}}{{ms.url_name}}</a>
                    {% else %}
                        (Para vizualizar agregue un encabezado)
                    {% endif %}
                </td>
                <td></td>
            </tr>
            <tr>
                <td>Fecha:</td>
                <td>{{ms.creation_date|date:"l j, F, Y"}} </td>
                <td></td>
            </tr>
            <tr>
                <td><span>Plantilla:</span></td>
                <td><div class="thematic_ms" id="thematic_ms_{{ms.id}}"></div></td>

                <td id="baseColors">Colores base:<div name="theme_ms" class="theme_ms" id="theme_ms_{{ms.id}}"></div></td>
<!--                <td><div name="theme_ms" class="theme_ms" id="theme_ms_{{ms.id}}"></div></td>-->

            </tr>
        </table>
        {% if not header %}
            <div class="btn-add">
                <a href="{% url 'upload_header' ms.id %}" class="btn btn-primary">Agregar Encabezado</a>
            </div>
        {% else %}
            <div style="text-align:center;">
                <h2 id="styleHeader">Encabezado</h2>
                <label>{{header.title}} - {{header.description}}</label>
            </div>
            <br>
            <table id="tabla_header" data-toggle="table" width=10>
                <thead>
                <tr>
                    <th>Logos</th>
                    <th>Estilos</th>
                    <th>Edición</th>
                    <th></th>
                </tr>
                </thead>
                <tbody class="ms-hide-links">
                {% if header %}
                <tr id="tr-id-{{header.id}}" class="tr-class-{{header.id}} sort_link" data-title="bootstrap table">
                    <td data-text="122" class="col-md-6">
                        {% if header %}
                        {% if header.image_1 %}
                        <a href="{{header.link_1}}">
                            <img src="{{MEDIA_URL}}/{{header.image_1}}" width="120px;" />
                        </a>
                        {% endif %}
                        {% if header.image_2%}
                        <a href="{{header.link_2}}">
                            <img src="{{MEDIA_URL}}/{{header.image_2}}" width="120px;" />
                        </a>
                        {% endif %}
                        {% if header.image_3 %}
                        <a href="{{header.link_3}}">
                            <img src="{{MEDIA_URL}}/{{header.image_3}}" width="120px;" />
                        </a>
                        {% endif %}
                        {% if header.image_4 %}
                        <a href="{{header.link_4}}">
                            <img src="{{MEDIA_URL}}/{{header.image_4}}" width="120px;" />
                        </a>
                        {% endif %}
                        {% if header.image_5 %}
                        <a href="{{header.link_5}}">
                            <img src="{{MEDIA_URL}}/{{header.image_5}}" width="120px;" />
                        </a>
                        {% endif %}
                        {% else %}
                        <i class="fa fa-times" aria-hidden="true"></i>
                        {% endif %}
                    </td>
                    {% if style %}
                    <td class="td-class-{{header.id}}" data-title="bootstrap table" class="col-md-1">
                        <a href="{% url 'update_style_header' ms.id style.id %}" class="btn btn-primary btn-sm">Editar estilo</a>
                    </td>
                    {% else %}
                    <td class="td-class-{{header.id}}" data-title="bootstrap table" class="col-md-1">
                        <div class="btn-add">
                            <a href="{% url 'upload_style_header' ms.id header.id %}" class="btn btn-primary btn-sm">Agregar Estilos</a>
                        </div>
                    </td>
                    {% endif %}
                    <td class="td-class-{{header.id}}" data-title="bootstrap table" class="col-md-4">
                        <a href="{% url 'update_header' ms.id header.id  %}" class="btn btn-primary btn-sm"><i class="fa fa-edit" aria-hidden="true"></i> Editar contenido</a>
                    </td>
                    <td class="col-md-1">
                        <a href="{% url 'remove_header' header.id %}" class="btn btn-primary btn-sm"><i class="fa fa-trash" aria-hidden="true"></i> Eliminar</a>
                    </td>
                </tr>
                {% endif %}
                </tbody>
            </table>
            <br>
            <!--menús-->
            <h2>Menús</h2>
            <table class="hor-minimalist-b" style="margin:0px;">
                <thead>
                <tr>
                    <th scope="col" colspan="3">
                        Menús
                        <a href="{% url 'upload_menu_parent' ms.id %}">
                                <span>
                              <i class="fa fa-plus fa-1x" title="Agregar menús" aria-hidden="true"></i>
                            </span>
                        </a>
                    </th>
                    <th>
                        URL (idegeo.centrogeo.org.mx/cms/multimedia/)
                    </th>
                    <th scope="col">
                        Sub Menús
                        <span class="ms-minimize-menu" style="float: right;">
                                 <i class="fa fa-compress fa-1x" title="Minimizar"></i>
                            </span>
                    </th>
                </tr>
                </thead>
                <tbody class="ms-hide-menu">
                {% for sect in menus|dictsort:"stack_order" %}
                {% if sect %}
                <tr id="{{sect.id}}" class="sort_menu">
                    <td>
                        <div><i class="fa fa-{{ sect.icon }} fa-1x" title="Ver Sub Menús" aria-hidden="true"></i> </div>
                    </td>
                    <td>
                        <div>{{ sect.name }}</div>
                    </td>
                    <td>
                    <span>
                    <a href="{% url 'upload_submenu' ms.id sect.id %}">
                    <i class="fa fa-plus fa-1x"  title="Agregar un sub Menú a {{sect.name}}" aria-hidden="true"></i>
                    </a>
                    </span>
                        <span>
                    <a href="{% url 'update_menu' ms.id sect.id %}">
                    <i class="fa fa-pencil fa-1x"  title="Editar Menú" aria-hidden="true"></i>
                    </a>
                    </span>
                        <span>
                    <a href="{% url 'remove_menu' ms.id sect.id %}">
                    <i class="fa fa-trash fa-1x" title="Eliminar Menú" aria-hidden="true"></i>
                    </a>
                    </span>
                    </td>
                    <td>
                        <div>{{ms.url_name}}/{{ sect.slug }}</div>
                    </td>
                    <td>
                        <table width="100%">
                            <tbody class="submenu">
                            {% for child in sect.children.all|dictsort:"stack_order" %}
                            <tr id="{{child.id}}" class="sort_submenu">
                                <td width="10%">
                                    <div>
                                        <i class="fa fa-{{ child.icon }} fa-1x" title="Ver Sub Menús" aria-hidden="true"></i>
                                    </div>
                                </td>
                                <td width="70%">
                                    <div>
                                        {{child}}
                                    </div>
                                </td>
                                <td width="10%">
                                    <span>
                                        <a href="{% url 'update_menu' ms.id child.id %}" data-toggle="tooltip" title="Editar Sub Menú" class="fa fa-pencil fa-1x"></a>
                                    </span>
                                </td>
                                <td width="10%">
                                    <span>
                                        <a href="{% url 'remove_menu' ms.id child.id %}" title="Eliminar Sub Menú" class="fa fa-trash fa-1x"></a>
                                    </span>
                                </td>
                                <td>
                                    <div>
                                        {{ms.url_name}}/{{child.slug}}
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                            </tbody>
                        </table>
                    </td>
                </tr>
                {% endif %}
                {% endfor %}
                </tbody>
            </table>
            <label style="font-size:12px;">Para agregar menús da clic en
              <a href="{% url 'upload_menu_parent' ms.id %}">
                <span>
                  <i class="fa fa-plus fa-1x" title="Agregar menús" aria-hidden="true"></i>
                </span>
              </a>
            </label>
            <!-- end menús -->
            <br><br>
            <div style="display:flex; justify-content: center;">
                <div style="margin: 0px 20px;">
                    <h2>Carrusel de Novedades</h2>
                    <a href="{% url 'main_list' ms.id %}">
                        <img src="{{STATIC_URL}}idegeo/content_handler/img/deslizador_color.svg" title="Agregar Novedades/Multimedia" width="150px"/>
                    </a>
                </div>
                <div style="margin: 0px 20px;">
                <h2>Secciones/Contenido</h2>
                    <a href="{% url 'section_list' ms.id %}">
                        <img src="{{STATIC_URL}}idegeo/content_handler/img/anadir.svg" title="Agregar Secciones/Contenido" width="150px"/>
                    </a>
                </div>
            </div>
            <br><br>
        {% endif %}
        <!--end header-->
    </div>
    <!--footer-->
    <br>
    {% if footer %}
    <table class="table table-dark">
        <thead>
        <tr>
            <th colspan="4">
                <h2 align="center">Pie de Página</h2>
            </th>
        </tr>
        </thead>
        <tbody>
        <tr class="tr-class-{{footer.id}} sort_link" data-title="bootstrap table">
            <td data-text="122" class="col-md-2">
                {% if footer %}
                {% if footer.image_1 %}
                <a href="{{footer.link_1}}">
                    <img src="{{MEDIA_URL}}/{{footer.image_1}}" width="100px;" />
                </a>
                {% endif %}
                {% if footer.image_2%}
                <a href="{{footer.link_2}}">
                    <img src="{{MEDIA_URL}}/{{footer.image_2}}" width="100px;" />
                </a>
                {% endif %}

                {% else %}
                <i class="fa fa-times" aria-hidden="true"></i>
                {% endif %}
            </td>
            <td class="td-class-{{footer.id}}" data-title="bootstrap table" class="col-md-7">
                <div>
                    {{footer.copyright}}
                    {% if footer.contact_1 %}
                    <div>- {{footer.contact_1}}</div>
                    <br>
                    {% endif %}
                    {% if footer.contact_2 %}
                    <div>- {{footer.contact_2}}</div><br>
                    {% endif %}
                    {% if footer.contact_3 %}
                    <div>- {{footer.contact_3}}</div>
                    {% endif %}
                </div>
                <a href="{% url 'update_footer' ms.id footer.id  %}" class="btn btn-primary btn-sm"><i class="fa fa-edit" aria-hidden="true"></i> Editar contenido</a>
            </td>
            {% if style_footer %}
            <td class="td-class-{{footer.id}}" data-title="bootstrap table" class="col-md-2">
                <a href="{% url 'update_style_footer' ms.id style_footer.id %}" class="btn btn-primary btn-sm">Editar estilo</a>
            </td>
            {% else %}
            <td class="td-class-{{footer.id}}" data-title="bootstrap table" class="col-md-2">
                <div class="btn-add">
                    <a href="{% url 'upload_style_footer' ms.id footer.id %}" class="btn btn-primary btn-sm">Agregar Estilos</a>
                </div>
            </td>
            {% endif %}

            <td class="col-md-1">
                <a href="{% url 'remove_footer' footer.id %}" class="btn btn-primary btn-sm"><i class="fa fa-trash" aria-hidden="true"> Eliminar</i></a>
            </td>
        </tr>
        </tbody>
    </table>
    {% else %}
        <div class="btn-add" style="text-align: center;">
            <a href="{% url 'upload_footer' ms.id %}" class="btn btn-primary">Agregar Pie de Página</a>
        </div>
    {% endif %}
    <!--end footer-->
</div>
{% endif %}
{% endblock %}

{% block extra_script %}
<script src="{{ STATIC_URL }}idegeo/interactive/js/jquery.mixitup.js" type="text/javascript"></script>
<script src='{{ STATIC_URL }}idegeo/map_interface/js/jquery.quicksearch.js'></script>
<script src="{{STATIC_URL}}idegeo/geonode/js/colorbox/jquery.colorbox.js"></script>
<script src="{{STATIC_URL}}idegeo/mviewer/js/dd.min.js" type="text/javascript"></script>
<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
<script src="https://unpkg.com/bootstrap-table@1.17.1/dist/bootstrap-table.min.js"></script>
{% include "home_detail.js" %}
{% endblock extra_script %}
